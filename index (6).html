<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Farewell Invitation</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }
      body {
        color: #fff;
        overflow-x: hidden;
      }

      /* ================= WELCOME ================= */
      .welcome-page {
        position: fixed;
        inset: 0;
        z-index: 20;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .welcome-page video {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .welcome-page::after {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, rgba(0,0,0,0.7), rgba(138,43,226,0.4));
        pointer-events: none;
      }
      .welcome-content {
        position: relative;
        z-index: 2;
        text-align: center;
      }
      .welcome-content h1 {
        font-size: 3.5rem;
        letter-spacing: 8px;
        margin-bottom: 50px;
        font-family: "Playfair Display", serif;
        background: linear-gradient(135deg, #FFD700, #FFA500, #FF69B4);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-shadow: 0 0 40px rgba(255, 215, 0, 0.3);
        animation: titleGlow 2s ease-in-out infinite alternate;
      }

      @keyframes titleGlow {
        from {
          filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.6));
        }
        to {
          filter: drop-shadow(0 0 40px rgba(255, 165, 0, 0.8));
        }
      }

      .enter-btn {
        position: relative;
        width: 260px;
        height: 60px;
        border-radius: 16px;
        border: none;
        background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF8C00 100%);
        color: #000;
        font-size: 1.3rem;
        font-weight: 700;
        letter-spacing: 2px;
        cursor: pointer;
        box-shadow: 0 0 40px rgba(255, 215, 0, 0.7), 0 8px 20px rgba(0, 0, 0, 0.4);
        transition: all 0.3s ease;
        overflow: hidden;
      }

      .enter-btn:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 0 60px rgba(255, 215, 0, 1);
      }

      /* ================= LOGIN ================= */
      .login-page {
        position: fixed;
        inset: 0;
        display: none;
        justify-content: center;
        align-items: center;
      }
      .login-page video {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .login-page::after {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(135deg, rgba(0,0,0,0.6), rgba(75,0,130,0.4));
        pointer-events: none;
      }

      .login-card {
        position: relative;
        z-index: 2;
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(25px);
        -webkit-backdrop-filter: blur(25px);
        padding: 40px 35px;
        width: 360px;
        border-radius: 24px;
        text-align: center;
        border: 2px solid rgba(255, 255, 255, 0.15);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        animation: fadeUp 1.2s ease;
      }

      .login-card h2 {
        font-size: 1.8rem;
        margin-bottom: 25px;
        background: linear-gradient(135deg, #FFD700, #FFA500);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 700;
      }

      .login-card input {
        width: 100%;
        padding: 15px 20px;
        margin: 10px 0;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(0, 0, 0, 0.4);
        color: white;
      }

      .login-card button {
        width: 100%;
        padding: 15px;
        margin-top: 10px;
        border-radius: 12px;
        border: none;
        background: linear-gradient(135deg, #FFD700, #FFA500);
        color: black;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .login-card button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(255, 215, 0, 0.5);
      }

      .error {
        display: none;
        color: #ff6b6b;
        margin-top: 15px;
        font-weight: 500;
      }

      .popup-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.85);
        backdrop-filter: blur(8px);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .back-btn {
        display: block;
        margin: 20px auto 0;
        padding: 12px 30px;
        background: linear-gradient(135deg, #FF6B6B, #FF8E53);
        border: none;
        border-radius: 10px;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 1rem;
      }

      .back-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(255, 107, 107, 0.4);
      }
    </style>
  
    <script src="https://unpkg.com/html5-qrcode"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
      /* Fixed Positions for Controls */
      #musicToggle { position: fixed; top: 15px; right: 15px; z-index: 1000; width: 45px; height: 45px; border-radius: 50%; border: 1px solid #FFD700; background: rgba(0,0,0,0.7); color: #FFD700; cursor: pointer; display: none; justify-content: center; align-items: center; backdrop-filter: blur(10px); box-shadow: 0 0 15px rgba(255,215,0,0.4); font-size: 1.2rem; }
      #mainMenuBtn { position: fixed; top: 15px; right: 75px; z-index: 1000; width: 45px; height: 45px; border-radius: 50%; border: 2px solid #FFD700; background: rgba(0,0,0,0.7); color: #FFD700; cursor: pointer; display: none; justify-content: center; align-items: center; backdrop-filter: blur(10px); box-shadow: 0 0 15px rgba(255,215,0,0.4); font-size: 1.2rem; }

      /* Responsive Typography */
      html { font-size: 16px; }
      @media (max-width: 480px) {
        html { font-size: 14px; }
        .welcome-content h1 { font-size: 2rem !important; letter-spacing: 4px !important; }
        .login-card { width: 90% !important; padding: 25px 20px !important; }
      }

      /* Elegant Music Studio */
      .music-studio-card {
        background: linear-gradient(145deg, #111, #000);
        border: 1px solid rgba(212, 175, 55, 0.4);
        padding: 25px;
        border-radius: 20px;
        width: 320px;
        text-align: center;
        box-shadow: 0 10px 40px rgba(0,0,0,0.8);
      }
      .music-list {
        margin: 20px 0;
        max-height: 180px;
        overflow-y: auto;
        padding-right: 5px;
      }
      .music-list::-webkit-scrollbar { width: 4px; }
      .music-list::-webkit-scrollbar-thumb { background: #D4AF37; border-radius: 10px; }
      .music-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        margin-bottom: 8px;
        background: rgba(255,255,255,0.03);
        border-radius: 10px;
        transition: 0.3s;
        border: 1px solid transparent;
      }
      .music-item:hover { border-color: #D4AF37; background: rgba(212, 175, 55, 0.05); }
      .music-item span { font-size: 0.9rem; font-weight: 400; color: #eee; }
      .music-item input[type="radio"] { accent-color: #D4AF37; width: 18px; height: 18px; cursor: pointer; }

      /* Perfect Circle Profile Pictures */
      .creator-grid {
        display: flex;
        justify-content: space-around;
        gap: 15px;
        margin-top: 20px;
      }
      .creator-card { flex: 1; text-align: center; }
      .profile-frame {
        width: 80px;
        height: 80px;
        margin: 0 auto 12px;
        border-radius: 50%;
        padding: 3px;
        background: linear-gradient(45deg, #D4AF37, #f9e297);
        box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
      }
      .profile-pic {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        object-fit: cover;
        display: block;
        background: #222; /* Fallback */
      }
      .creator-name { font-family: 'Cinzel', serif; font-size: 0.85rem; color: #D4AF37; margin-bottom: 4px; }
      .creator-email { font-size: 0.6rem; opacity: 0.6; word-break: break-all; line-height: 1.2; }

      /* Gate Master Updates */
      .gate-container { width: 95%; max-width: 400px; background: #000; border: 1.5px solid #D4AF37; border-radius: 15px; padding: 20px; box-shadow: 0 0 30px rgba(212,175,55,0.2); }
      #reader { border-radius: 12px; border: 1px solid #D4AF37 !important; overflow: hidden; margin: 15px 0; }

      .menu-popup {
        position: fixed; top: 70px; right: 15px; background: rgba(0,0,0,0.95);
        border: 1px solid #FFD700; border-radius: 12px; padding: 8px; display: none;
        flex-direction: column; gap: 5px; z-index: 1001; width: 160px;
        backdrop-filter: blur(10px);
      }
      .menu-item { padding: 12px; color: #FFD700; cursor: pointer; text-align: center; font-family: 'Cinzel'; font-size: 0.75rem; transition: 0.3s; }
      .menu-item:hover { background: rgba(255,215,0,0.1); }
      
      /* Hidden file input */
      #qr-input-file { display: none; }
    </style>

</head>
  <body>

    <audio id="globalMusic" src="music1.mp3" loop></audio>
    <button id="musicToggle" onclick="openMusicPopup()">üîä</button>
    <button id="mainMenuBtn" onclick="toggleMenu()">üõ†Ô∏è</button>

    <div class="menu-popup" id="menuPopup">
        <div class="menu-item" onclick="openScanner()">üì± Gate Master</div>
        <div class="menu-item" onclick="openCreatorPopup()">üë®‚Äçüíª Creators</div>
    </div>

    <div class="popup-overlay" id="musicPopup">
      <div class="music-studio-card">
        <h3 style="font-family:'Cinzel'; color:#D4AF37; letter-spacing: 2px;">MUSIC STUDIO</h3>
        <div class="music-list" id="musicList"></div>
        <div style="display:flex; gap:12px; margin-top: 10px;">
            <button class="back-btn" onclick="controlMusic('play')" style="flex:1; background:#D4AF37; color:#000; margin:0; font-weight:700;">PLAY</button>
            <button class="back-btn" onclick="controlMusic('stop')" style="flex:1; background:transparent; border:1px solid #ff4444; color:#ff4444; margin:0;">STOP</button>
        </div>
        <button class="back-btn" onclick="closePopup('musicPopup')" style="margin-top:20px; width:100%; background:rgba(255,255,255,0.05); color:#aaa; border:none;">BACK</button>
      </div>
    </div>

    <div class="popup-overlay" id="creatorPopup">
      <div class="gate-container" style="max-width: 350px;">
        <h3 style="font-family:'Cinzel'; color:#D4AF37; margin-bottom: 10px;">THE CREATORS</h3>
        <div class="creator-grid">
            <div class="creator-card">
                <div class="profile-frame"><img src="shivam.jpg" class="profile-pic" alt="S"></div>
                <div class="creator-name">Shivam</div>
                <div class="creator-email">yshivamkumar212@gmail.com</div>
            </div>
            <div class="creator-card">
                <div class="profile-frame"><img src="sahil.jpg" class="profile-pic" alt="S"></div>
                <div class="creator-name">Sahil</div>
                <div class="creator-email">sahilrajkedar2801@gmail.com</div>
            </div>
        </div>
        <button class="back-btn" onclick="closePopup('creatorPopup')" style="margin-top:25px; width:100%;">CLOSE</button>
      </div>
    </div>

    <div class="popup-overlay" id="scannerPopup">
      <div class="gate-container">
        <h2 style="font-family:'Cinzel'; color:#D4AF37; font-size:1.3rem;">GATE MASTER</h2>
        <div id="reader"></div>
        
        <button class="back-btn" id="startCamBtn" onclick="initScanner()" style="background:#D4AF37; color:#000; width:100%; border:none;">START CAMERA</button>
        
        <button class="back-btn" onclick="document.getElementById('qr-input-file').click()" style="margin-top:10px; width:100%; background:transparent; border:1px solid #D4AF37; color:#D4AF37;">UPLOAD QR IMAGE</button>
        <input type="file" id="qr-input-file" accept="image/*" onchange="handleFileUpload(this)">

        <button class="back-btn" onclick="closeScanner()" style="margin-top:15px; width:100%; background:transparent; border:1px solid #444;">CLOSE TERMINAL</button>
      </div>
    </div>

    <div class="welcome-page" id="welcomePage">
      <video autoplay muted loop playsinline><source src="video4.mp4" /></video>
      <div class="welcome-content">
        <h1>WELCOME XAVERIANS</h1>
        <button class="enter-btn" onclick="enterSite()">ENTER</button>
      </div>
    </div>

    <div class="login-page" id="loginPage">
      <video autoplay muted loop playsinline><source src="video1.mp4" /></video>
      <div class="login-card">
        <h2>üîí Memory Lock</h2>
        <input id="username" placeholder="Enter Your Name" autocomplete="off" />
        <input id="password" type="password" placeholder="Your Secret Code" autocomplete="off" />
        <button id="loginBtn">Unlock Memories</button>
        <div class="error" id="error">‚ùå Access Denied</div>
        <div style="margin-top: 15px; font-size: 0.8rem; color: #aaa;">üí° Hint: Your code is yourname + 3 digits</div>
      </div>
    </div>

    <script>
      const allowedNames = ['sahil raj', 'shivam', 'ayush mehta', 'pranjal', 'shreyansh', 'kunj', 'rishav', 'himanshu', 'mansi', 'muskan', 'srijan', 'shiddant', 'swati', 'nancy', 'ayush', 'asif jamal', 'payal', 'shristy', 'sakshi priya', 'vandana', 'rudrani', 'priyanshi', 'kajal', 'nihal', 'om', 'ananya', 'aishwarya', 'asifa', 'milki', 'siddhi', 'sanjana', 'suhana', 'rashi', 'vaishnavi', 'yamini', 'aayushi', 'richa', 'riya', 'shiba', 'manya', 'minakshi'];
      const userCredentials = {'sahil raj': 'lencho', 'shivam': 'lencho', 'ayush mehta': 'ayushmehta856', 'pranjal': 'lencho', 'shreyansh': 'shreyansh463', 'kunj': 'kunj507', 'manya': 'manya729', 'minakshi': 'minakshi841'};
      const music = document.getElementById("globalMusic");
      let html5QrCode;
      let isProcessing = false;
      let currentTrack = "music1.mp3";

      function enterSite() {
        music.play().catch(e => console.log("Audio play failed"));
        document.getElementById("welcomePage").style.display = "none";
        document.getElementById("loginPage").style.display = "flex";
        document.getElementById("musicToggle").style.display = "flex";
        document.getElementById("mainMenuBtn").style.display = "flex";
      }

      function toggleMenu() {
        const menu = document.getElementById("menuPopup");
        menu.style.display = menu.style.display === "flex" ? "none" : "flex";
      }

      function openMusicPopup() { renderTracks(); document.getElementById("musicPopup").style.display = "flex"; }
      function openCreatorPopup() { document.getElementById("menuPopup").style.display = "none"; document.getElementById("creatorPopup").style.display = "flex"; }
      function closePopup(id) { document.getElementById(id).style.display = "none"; }

      function renderTracks() {
        const list = document.getElementById("musicList");
        list.innerHTML = "";
        for(let i=10; i<=15; i++) {
          const track = `music${i}.mp3`;
          const div = document.createElement("div");
          div.className = "music-item";
          div.innerHTML = `<span>Track Name ${i}</span><input type="radio" name="trk" ${currentTrack === track ? 'checked' : ''} onchange="currentTrack='${track}'">`;
          list.appendChild(div);
        }
      }

      function controlMusic(action) {
        if(action === 'play') {
          // Check if the source is different before assigning to avoid reload
          if (!music.src.includes(currentTrack)) {
             music.src = currentTrack;
          }
          music.play();
          document.getElementById("musicToggle").innerText = "üîä";
        } else {
          music.pause();
          document.getElementById("musicToggle").innerText = "üîá";
        }
      }

      function openScanner() {
        document.getElementById("menuPopup").style.display = "none";
        document.getElementById("scannerPopup").style.display = "flex";
        // Initialize instance if not already done (avoids recreation)
        if (!html5QrCode) {
           html5QrCode = new Html5Qrcode("reader");
        }
      }

      function initScanner() {
        // Dynamic box size for mobile/desktop
        const qrBoxSize = window.innerWidth < 600 ? 200 : 250;
        
        html5QrCode.start({ facingMode: "environment" }, { fps: 15, qrbox: qrBoxSize }, (text) => {
          if(!isProcessing) handleScan(text);
        }).then(() => {
          document.getElementById('startCamBtn').style.display = "none";
        }).catch(err => {
            alert("Camera Error: " + err);
        });
      }

      function handleFileUpload(input) {
         if (input.files.length === 0) return;
         const imageFile = input.files[0];
         
         // Use the existing html5QrCode instance
         if (!html5QrCode) html5QrCode = new Html5Qrcode("reader");

         html5QrCode.scanFile(imageFile, true)
            .then(decodedText => {
                handleScan(decodedText);
            })
            .catch(err => {
                alert("Error scanning file. Please ensure it's a clear QR code.");
                console.error(err);
            });
         // Reset input so same file can be selected again if needed
         input.value = '';
      }

      function handleScan(data) {
        isProcessing = true;
        const prefix = "FAREWELL-2026-PASS-";
        if(data.includes(prefix)) {
          const name = data.replace(prefix, "").replace(/%20/g, " ").toLowerCase().trim();
          if(allowedNames.includes(name)) {
            alert(`Welcome ${name.toUpperCase()}! Access Granted.`);
            
            localStorage.setItem('user_name', name); // Save user session
            
            // Close scanner gracefully and redirect to actual destination
            if(html5QrCode && html5QrCode.isScanning) {
                html5QrCode.stop().then(() => {
                    window.location.href = "memory_wall.html"; 
                }).catch(() => {
                    window.location.href = "memory_wall.html"; 
                });
            } else {
                window.location.href = "memory_wall.html";
            }
            
          } else { 
              alert("Access Denied: Name not in list."); 
              isProcessing = false;
          }
        } else {
             // Handle invalid QR codes smoothly
             setTimeout(() => { isProcessing = false; }, 2000);
        }
      }

      function closeScanner() {
        if(html5QrCode && html5QrCode.isScanning) {
          html5QrCode.stop().then(() => {
            document.getElementById("scannerPopup").style.display = "none";
            document.getElementById('startCamBtn').style.display = "block";
            // Auto play music10 on close
            currentTrack = "music10.mp3";
            music.src = currentTrack;
            music.play();
          });
        } else { 
            document.getElementById("scannerPopup").style.display = "none"; 
        }
      }

      document.getElementById("loginBtn").onclick = () => {
        const u = document.getElementById("username").value.toLowerCase().trim();
        const p = document.getElementById("password").value.toLowerCase().trim();
        if (userCredentials[u] === p || (allowedNames.includes(u) && p === "lencho")) {
          localStorage.setItem('user_name', u);
          window.location.href = "memory_wall.html";
        } else { document.getElementById("error").style.display = "block"; }
      };

</script>
  </body>
</html>
